<style>
	.provider_container{
		border-bottom: 1px black dotted;
	}
	.print{
		width: 100px;
		cursor: pointer;

	}
	.right{
		text-align: right;
		padding-right: 10px;
	}
	.mainDiv{
		display:none;
	}
	#select_all, #unselect_all {
		cursor: pointer;
		color: #00388b;
		font-size: 10px;
		text-decoration: underline;
	}
	#select_all:hover, #unselect_all:hover  {
		color:#ff0000; background-color:transparent
	}
	.first{
		width: 5%;
	}
	.second{
		width: 80%;
	}
	.third{
		width: 15%;
	}
</style>

<script>
function printImg() {
    var divToPrint = document.getElementById('mainDiv');
    newWin = window.open("");
    // Css y salto de pagina cuando un div queda cortado en la impresion
    newWin.document.write('<style>' + 
    						'@media print{.no-print{display:none;} .table-print{font-size: 10px; page-break-inside: avoid; padding-top:155px;} .nameContainer{width: 40%; text-align: center;} .dateContainer{width: 25%;} .tableTrData{vertical-align:top;} .tableContainer{padding-top:60px;} #bodyTable{height: 170px;overflow-y: auto;}.headerContainer > div, .footerContainer .footerContainerCopy > div {display: inline-block;text-align: right;} .footerContainer{margin-bottom: 76px;} tr {width:100%;}td {text-align: right;padding-right: 40px;}.tableClass {width:100%;}.subTotalContainer {width: 16.6%;}} ' +
    					'</style>');
	newWin.document.write(divToPrint.outerHTML);
	newWin.print();
	newWin.close();
}

$(document).ready(function(){
	$('.print').click(function(){
		var someChecked = false;
		$('input[type="checkbox"]').each(function(){
			if ($(this).is(':checked')) {
				someChecked = true;
			} 
		});
		if (someChecked) {
			printImg();
		} else {
			alert('No se ha seleccionado ninguna factura para imprimir, por favor seleccione.');
		}
	});
	clickCheckbox();
	clickSelectAll();
	clickUnselectAll();
});

function clickCheckbox() {
	$('input[type="checkbox"]').click(function() {
	    var id = $(this).val();
	    if ($(this).is(':checked')) {
        	$('#' + id +'_1').removeClass('no-print');
        	$('#' + id +'_2').removeClass('no-print');
	    } else {
	        $('#' + id +'_1').addClass('no-print');
	        $('#' + id +'_2').addClass('no-print');
	    }
	});
}

function clickSelectAll() {
	$('#select_all').click(function() {
		$('input[type="checkbox"]').prop('checked', 'true');
		
		$('input[type="checkbox"]').each(function() {
			var id = $(this).val();
	    	$('#' + id +'_1').removeClass('no-print');
	    	$('#' + id +'_2').removeClass('no-print');
		});
	});
}

function clickUnselectAll() {
	$('#unselect_all').click(function() {
		$('input[type="checkbox"]').removeAttr('checked');
		
		$('input[type="checkbox"]').each(function() {
			var id = $(this).val();
			$('#' + id +'_1').addClass('no-print');
		    $('#' + id +'_2').addClass('no-print');
		});
	});
}
</script>

<style>
#billing_table{
    height: 800px;
    overflow-y: auto;
}
</style>

<div id="billing_table">
	<h3> Facturas ganancia neta para imprimir del mes <%= Time.now.strftime("%m-%Y") %></h3>
	<% first = true %>
	<% @providers_to_print.each do |provider| %>
     <div class="provider_container" id="provider_container_<%= provider.id%>">
		<p>Sr/Sra. <%= provider.name %> <%= provider.lastname %></p>
		<% if first %>
			<a id="select_all">Todas</a>
			<a id="unselect_all">Ninguna</a>
		<% end %>
		<% first = false %>
		<table id="articles">
			<thead>
		        <tr>
		        	<th><input type="checkbox" value="<%= provider.id %>" id="check" name="check"/></th>
					<th>Detalle</th>
					<th>Importe</th>
		        </tr>
		      </thead>
			<tbody>
				<% total = 0 %>
				<% (provider.instance_variable_get "@custom_input_list").each do |input| %>
					<% total = total + input.comission_cash.to_i %>
				<% end %>
				<tr>
					<td class="first"></td>
					<td class="second">Comisión por intermediación del mes <%= Time.now.strftime("%m-%Y") %></td>
					<td class="third">$<%= total - total * 0.22 %></td>
				</tr>
				<tr>
					<td class="first"></td>
					<td class="right second">SUB TOTAL</td>
					<td class="third">$<%= total - total * 0.22 %></td>
				</tr>
				<tr>
					<td class="first"></td>
					<td class="right second">IVA</td>
					<td class="third">$<%= total * 0.22 %></td>
				</tr>
				<tr>
					<td class="first"></td>
					<td class="right second">TOTAL</td>
					<td class="third">$<%= total %></td>
				</tr>
			</tbody>
		</table>
		<p> Montevideo, <%= Time.now.strftime("%d-%m-%Y") %></p>
	</div>
	<% end %>
</div>
<div>
	<button class="print">Imprimir</button>
</div>

<div id="mainDiv" class="mainDiv">
	<% @providers_to_print.each do |provider| %>
		<div class="table-print no-print" id="<%= provider.id %>_1">
			<% total = 0 %>

			<div id="headerContainer" class="headerContainer">
				<table id="headerTable" class="tableClass">
					<tr>
						<td class="nameContainer">
							<p>Sr/Sra. <%= provider.name %> <%= provider.lastname %></p>
						</td>
						<td class="nameContainer">
							<p><%= provider.address %></p>
						</td>
						<td class="dateContainer">
							<p><%= Time.now.strftime("%d-%m-%Y") %></p>
						</td>
					</tr>
				</table>
			</div>

			<div class="tableContainer">
				<table id="bodyTable" class="tableClass">
					<thead>
				    </thead>
					<tbody>
						<% (provider.instance_variable_get "@custom_input_list").each do |input| %>
							<% total = total + input.comission_cash.to_i %>
						<% end %>
						<tr class="tableTrData">
							<td class="tableData">Comisión por intermediación del mes <%= Time.now.strftime("%m-%Y") %></td>
							<td>$<%= total - total * 0.22 %></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="footerContainer">
				<table id="footerTable" class="tableClass">
					<tr>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
							$<%= total - total * 0.22 %>
						</td>
						<td class="subTotalContainer">
							$<%= total * 0.22 %>
						</td>
						<td class="subTotalContainer">
							$<%= total %>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<div class="table-print no-print" id="<%= provider.id %>_2">
			<% total = 0 %>

			<div id="headerContainer" class="headerContainer">
				<table id="headerTable" class="tableClass">
					<tr>
						<td class="nameContainer">
							<p>Sr/Sra. <%= provider.name %> <%= provider.lastname %></p>
						</td>
						<td class="nameContainer">
							<p><%= provider.address %></p>
						</td>
						<td class="dateContainer">
							<p><%= Time.now.strftime("%d-%m-%Y") %></p>
						</td>
					</tr>
				</table>
			</div>

			<div class="tableContainer">
				<table id="bodyTable" class="tableClass">
					<thead>
				    </thead>
					<tbody>
						<% (provider.instance_variable_get "@custom_input_list").each do |input| %>
							<% total = total + input.comission_cash.to_i %>
						<% end %>
						<tr class="tableTrData">
							<td class="tableData">Comisión por intermediación del mes <%= Time.now.strftime("%m-%Y") %></td>
							<td>$<%= total - total * 0.22 %></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="footerContainerCopy">
				<table id="footerTable" class="tableClass">
					<tr>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
						</td>
						<td class="subTotalContainer">
							$<%= total - total * 0.22 %>
						</td>
						<td class="subTotalContainer">
							$<%= total * 0.22 %>
						</td>
						<td class="subTotalContainer">
							$<%= total %>
						</td>
					</tr>
				</table>
			</div>
		</div>
	<% end %>
</div>
<style type="text/css">
    .last_td{
        text-align: right;
        padding-right: 30px;
    }
    
    a, a:visited {
        color:#333;
    }
</style>
<script>
    $(document).ready(function(){
        $('table.inputTable').sieve();
        $('table.outputTable').sieve();
    });
</script>

<div class="modalBackgroundReprint">
    <div id="newInputPopup" >
        
        <div id="articleDetailContainerReprint">

        </div>

    </div>

</div>

<h3>Caja Anterior</h3>
    <% if !@isclosed %>
        <p>$ <%= @last_caja_total %></p>
    <% else %>
        <p id="notice"><%= notice %></p>
    <% end %>

<h3>Ingresos</h3>

<%= form_tag(controller: "inputs", action: "batch_receipt") do %>

    <div class="tableContainer">

        <table class="inputTable">
            <thead>
                    <tr>
                        <th>Código</th>
                        <th>Monto</th>
                        <th>Porcentaje</th>
                        <th>Ganancia Neta</th>
                        <th>Descripción</th>
                        <th>Tipo</th>
                        <th>Vestuarista</th>
                        <th>Creado</th>
                        <th>Reimprimir</th>
                        <th></th>
                    </tr>
            </thead>
            <tbody>
                <% if @today_inputs.length > 0 %>
                        <% @today_inputs.each do |transaction|  %>
                            <tr id="<%= transaction.article ? transaction.article.id : transaction.article_id %>">
                                <td><%= transaction.article ? transaction.article.id : transaction.article_id %></td>
                                <td>$<%= transaction.amount %></td>
                                <td><% if transaction.comission_per %> 
                                        <% if transaction.comission_per != "100" %>
                                            <%= transaction.comission_per + "% + iva" %>
                                        <% else %>
                                            <%= transaction.comission_per + "%" %>
                                        <% end %>
                                    <% else %>
                                        <%= "-" %>
                                    <% end %>
                                </td>
                                <td>$<%= transaction.comission_cash ? transaction.comission_cash  : transaction.amount%></td>
                                <td>
                                    <%= transaction.article_desc %>
                                </td>
                                <td><%= transaction.obtain_human_label %></td>
                                <td><%= transaction.staff ? (link_to transaction.staff.name + ' ' + transaction.staff.lastname, transaction.staff) : '-' %></td>
                                <td><%= l transaction.created_at %></td>
                                <td>
                                <% if transaction.status == "active" && %>
                                    <!-- here set correct staff-id -->
                                    <%= check_box_tag 'inputs[]', transaction.id, false, data: { "input-type" => transaction.type, "staff-id" => transaction.id }, :class => 'inputCheckbox' %>
                                <% end %>
                                </td>
                                <% if transaction.status == "active" %> 
                                    <!--  Es un transaction normal (no es cancel transaction) -->   
                                    <td class="last_td">        
                                        <%= button_to("Anular", {:action => "cancel_transaction", :transaction_to_cancel => transaction.id, :cancel_type => 'input'}, :class => 'collect', :confirm => 'Seguro que desea anular la transacción?')%>
                                    </td>
                                <% elsif transaction.status == "cancelled" %>
                                    <td class="last_td">Anulado</td>
                                <% elsif transaction.status == "cancel_input" %>
                                    <!-- click aca, que agregue clase para animacion de transaction anulado -->
                                    <td class="last_td">Anula: <a href="/inputs/<%= transaction.cancel_id %>" target="_blank"> transacción <%= transaction.cancel_id %></a></td>
                                <% end %>
                            </tr>       
                        <% end %>   
                <% else %>
                    No hay ingresos en la caja de hoy.
                <% end %>
            </tbody>    
        </table>
    </div>
    <div class="reprintContainer">
        <div id="submitSalesContainer" class="hide">
            <%= submit_tag 'Reimprimir ventas seleccionadas', :disable_with => 'Espere', :class => 'submit c-submit collect' %>
        </div>

        <div id="submitRentsContainer" class="hide">
             <input type="button" value="Reimprimir alquileres seleccionadas" id="printRents" class="submit c-submit collect"/>
        </div>
    </div>

<% end %>
<strong>Total ingresos: $<%= @today_inputs_total %></strong>

<h3>Egresos</h3>
<div class="tableContainer">
    <table class="outputTable">
        <thead>
                <tr>
                    <th>Código</th>
                    <th>Monto</th>
                    <th>Descripción</th>
                    <th>Tipo</th>
                    <th>Creado</th>
                    <th>Fuera de Caja</th>
                    <th></th>
                </tr>
        </thead>
        <tbody>
            <% if @today_outputs.length > 0 %>
                <% @today_outputs.each do |transaction|  %>
                    <tr>
                            <td><%= transaction.id %></td>
                            <td>$<%= transaction.amount %></td>
                            <td>
                                <% if transaction.article.present? %>
                                    <!--  El transaction tiene articulo, asi que mostramos su descripcion -->
                                    <a href="/articles/<%= transaction.article.id %>">
                                        <%= transaction.article.description %>
                                    </a>
                                <% elsif transaction.concept? %>
                                    <%= transaction.concept %>  
                                <% end %>
                            </td>
                            <td><%= transaction.obtain_human_label %></td>
                            <td><%= l transaction.created_at %></td>
                            <td><%= transaction.fuera_caja ? 'Fuera de caja' : ''%></td>
                            <% if transaction.status == "active" %> 
                                <!--  Es un transaction normal (no es cancel transaction) -->   
                                <td class="last_td">        
                                    <%= button_to("Anular", {:action => "cancel_transaction", :transaction_to_cancel => transaction.id, :cancel_type => 'output'}, :confirm => 'Seguro que desea anular la transacción?')%>
                                </td>
                            <% elsif transaction.status == "cancelled" %>
                                <td class="last_td">Anulado</td>
                            <% elsif transaction.status == "cancel_input" %>
                                <!-- click aca, que agregue clase para animacion de transaction anulado -->
                                <td class="last_td">Anula: <a href="/outputs/<%= transaction.cancel_id %>" target="_blank"> transacción <%= transaction.cancel_id %></a></td>
                            <% end %>
                    </tr>   
                <% end %>
            <% else %>
                No hay egresos en la caja de hoy.
            <% end %>
        </tbody>        
    </table>
</div>
<strong>Total egresos: $<%= @today_outputs_total %> </br></strong>

<h3>Total: $ <%= @today_inputs_total + @last_caja_total + @today_outputs_total %></h3>
